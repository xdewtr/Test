<!DOCTYPE html>
<html>
<body>
<div id="div1">
<FORM>
<TABLE BORDER=0 CELLPADDING=5 CELLSPACING=0 BGCOLOR="#737CA1">
<TR><TD><FONT SIZE=4>Choose the game u want</FONT></TD></TR><TR><TD>
<p>Input number of players here.</p>
<br>
<input type="text" name="txt" id="txt"/>
<br>
<SELECT id="select1" NAME="SelectMenu" onChange="jumpP(this.form)">

<OPTION>
<OPTION>BlackJack
<OPTION>DA LAO ERRRR
</SELECT>


</TD></TR></TABLE>
</FORM>
</div>
<br>
<br>
<div id="displayla">
</div>

<script src="source.js"></script>

<script langugae="javascript">



/* BUG LOG 

NONE

*/
/*============Self-defined var============*/
/*
    1  - 13     01 - 0d
    17 - 29     11 - 1d
    33 - 45     21 - 2d
    49 - 61     31 - 3d
*/
//  Memory doesn't cost that much
    var num = [" ","A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    var suit = ["Clover","Diamond","Heart","Spade"];
/*
new Card
*/
//  sol one    
    var msg = [ "BUSTED",
                "BlackJack",
                "You WIN",
                "Out of Cards"];

    var thirteenMsg = [ "FULLHOUSE",
                        "QUAD",
                        "Straight",
                        "Straight Flush",
                        "Nothing special",
                        "Two Pairs",
                        "A Pair"];

    var numbuf = [0,0,0,0,0,0,0,0,0,0,0,0,0];
    var suitbuf = [0,0,0,0];

    var nummask = 0x0f;
    var suitshift = 4;
    var dplay= document.getElementById("displayla");
    var ourDiv = document.getElementById("div1");

    // game should contain these following things
    // shuffle and getCards

    function BlackJack(){
        Round.apply(this, arguments);               // this one is crucial

        this.rule = function rule(idx,cnt){
        /*
            keep getting cards til sum > 17 count > 5
            when sum > 17 judge whether it exceeds 21 print diff msg
        */
            if (cnt == 6){
                return true;
            }
            else{
                switch(idx){
                    case 11: 
                    case 12:
                    case 13:
                        sum += 10;
                        break;
                    case 1:
                        sum += 11;
                        if(sum > 21)
                           sum -= 10;
                        break;
                    default:
                       sum += idx;
                }    
                if(sum > 17)
                    return true;
            }

            return false;
        }

        this.condMsg = function condMsg(s,arr){

            if(s > 21){
                return msg[0];
            }
            else if (s == 21)
                return msg[1];
            else if(s < 22 && outofcard == 0)
                return msg[2];
        }

    }

    BlackJack.prototype = new Round();


    function Thirteen(){
        Round.apply(this, arguments);
        this.rule = function rule(idx,cnt){
        /*
            keep getting cards til sum > 17 count > 5
            when sum > 17 judge whether it exceeds 21 print diff msg
        */

            if (cnt == 5){
                return true;
            return false;
            }
        }

        this.condMsg = function condMsg(s,arr){
            for(i in arr){
                numbuf[(arr[i]&nummask) -1]++;
                suitbuf[arr[i]>>suitshift]++;
            }
            console.log(numbuf);
            console.log(suitbuf);


            var top = topandbotFinder(numbuf,true);
            var bot = topandbotFinder(numbuf,false);

            var diff = bot - top;   
    
            // still need to detect royal

            /*   NOTE 
                !numFinder(2,numbuf)&&!numFinder(3,numbuf)
                check out 
                41
                32
                311            -> no two
                221
                2111
                11111          -> no two
            */
            if(diff >= 3 ){
                if(diff == 4){                           // straight
                    if(!numFinder(2,numbuf)&&!numFinder(3,numbuf)){
                        console.log("Straight");
                        return thirteenMsg[2];            
                    }
                    else if (numFinder(5,suitbuf)){
                        console.log("Straight Flush");
                        return thirteenMsg[3];
                    }
                }
            }
            else if (diff == 12){
                if(numbuf[9]==1 && numbuf[10]==1 && numbuf[11]==1){
                    if(!numFinder(2,numbuf)&&!numFinder(3,numbuf)){
                        console.log("Straight");
                        return thirteenMsg[2];
                    }
                    else if (numFinder(5,suitbuf)){
                        console.log("Straight Flush");
                        return thirteenMsg[3];
                    }
                }
            }


            numbuf.sort(function(a,b){return b - a});

            if(numbuf[0] == 3 && numbuf[1] == 2){
                console.log("FULLHOUSE");
                return thirteenMsg[0];
            }

            else if(numbuf[0] == 4){
                console.log("QUAD");
                return thirteenMsg[1];
            }

            else if(numbuf[1]==2)
            {
                return thirteenMsg[5];    
            }
            else if(numbuf[0]==2)
            {
                return thirteenMsg[6];
            }


            console.log(numbuf);


            // if we reach here then nothing special
            
            return thirteenMsg[4]; 

        }
        

    }
    Thirteen.prototype = new Round();


    function init(){
        ourDiv.style.visibility='visible';
        numPlayer = document.getElementById("txt").value;        
    }




    // chaning all the time
    var sum = 0;        // this will measure whether we blow up or not  
    var count = 0;
    var outofcard = 0;

    var numIdx;
    var suitIdx;
//  Initialization
    var numPlayer=5;
    var anotherGame;




    
    


//========== helper function =====================//

function numFinder(num,arr){
    for(i in arr){
        if(arr[i]==num)
            return true;
    }
    return false;

}

function topandbotFinder(arr,t){ // t is true if we want to find top
    var temp;
    if(t){
        for(i in arr){
            if(arr[i]==1)
                return i;
        }
    }
    else{
        for(i in arr){
            if(arr[i]==1)
                temp = i;
        }
        return temp;
    }

}
function jumpP(form){
        do{
            var i = form.SelectMenu.selectedIndex;
            
            ourDiv.style.visibility='hidden';


            if(i == null)
                return;
            if(i == 1){ //BJ
                var blackJack = new BlackJack();
                blackJack.shuffle();
    
                blackJack.getCards();
                
                blackJack.display();
            }

            if(i == 2){ // 13

                var thirteen = new Thirteen();

                thirteen.shuffle();
                thirteen.getCards();
                thirteen.display();

            }  



        // ask if we still want to play

            anotherGame = prompt("Do u still want to play the same game?","yes");
                if(anotherGame == "yes")
                    anotherGame = true;
                else{
                    anotherGame = false;
                }
            
        }while(anotherGame);
        init();
    };

</script>

</body>
</html>
